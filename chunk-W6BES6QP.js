import{A as G,B as O,C as j,D as $,E as B,F as Q,I as Y,J as z,P as H,T as J,U as K,W,ma as Z,za as ee}from"./chunk-YJA7LBCE.js";import{Cb as E,Ea as s,Fa as n,Ga as i,Ha as d,Lb as C,Qa as I,Ra as A,Tb as F,_b as D,a as h,ac as c,b as M,db as r,dc as b,ea as m,eb as v,ec as _,ia as p,ic as N,jc as y,lc as x,ma as S,md as q,oc as T,qa as u,qc as w,rc as L,rd as P,tc as U,td as V,uc as R,vc as k,vd as X}from"./chunk-JUX2TMYD.js";function ie(a,e){a&1&&(n(0,"mat-error"),r(1,"Requerido."),i())}function ne(a,e){a&1&&(n(0,"mat-error"),r(1,"Requerido."),i())}function re(a,e){a&1&&(n(0,"mat-error"),r(1,"Requerido."),i())}function oe(a,e){a&1&&(n(0,"mat-error"),r(1,"Requerido."),i())}function ae(a,e){a&1&&(n(0,"div",8)(1,"h3"),r(2,"Proyecciones (opcional)"),i(),n(3,"div",9)(4,"mat-form-field",10)(5,"mat-label"),r(6,"Aumento (%)"),i(),d(7,"input",27),n(8,"span",28),r(9,"%"),i()(),n(10,"mat-form-field",10)(11,"mat-label"),r(12,"Periodicidad Aumento"),i(),n(13,"mat-select",29)(14,"mat-option",30),r(15,"Anual"),i(),n(16,"mat-option",31),r(17,"Semestral"),i(),n(18,"mat-option",32),r(19,"Trimestral"),i()()()()())}function me(a,e){a&1&&(n(0,"mat-error"),r(1,"Requerido."),i())}function le(a,e){a&1&&(n(0,"mat-form-field",10)(1,"mat-label"),r(2,"Duraci\xF3n (meses)"),i(),d(3,"input",33),n(4,"mat-hint"),r(5,"Dejar vac\xEDo si es indefinido"),i()())}function se(a,e){a&1&&d(0,"mat-spinner",34)}function ce(a,e){if(a&1&&(n(0,"span"),r(1),i()),a&2){let o=A();m(),v(o.isEditing?"Guardar":"Crear")}}var te=class a{constructor(e,o,t,l,f){this.dialogRef=e;this.data=o;this.cdr=t;this.fb=l;this.appStateService=f;this.ingresoForm=this.createForm()}onSave(){this.onSubmit()}ingresoForm;loading=!1;isEditing=!1;montoPreview="";ngOnInit(){this.setupFormSubscriptions(),this.isEditing=this.data.mode?this.data.mode==="edit":!!this.data.ingreso,this.data.ingreso?this.loadIngresoData():this.resetFormData()}ngAfterViewInit(){this.cdr.detectChanges()}createForm(){return this.fb.group({fuente:["",[c.required,c.minLength(2),c.maxLength(50)]],descripcion:["",[c.required,c.minLength(3),c.maxLength(100)]],montoInicial:[0,[c.required,c.min(.01)]],fechaInicio:[this.getCurrentMonth(),[c.required]],frecuencia:["MENSUAL",[c.required]],proyeccionAumento:[0],periodicidadAumento:["ANUAL"],duracionMeses:[null],notas:[""],activo:[!0]})}setupFormSubscriptions(){this.montoInicial?.valueChanges.subscribe(e=>{this.updateMontoPreview(e)}),this.frecuencia?.valueChanges.subscribe(e=>{this.handleFrecuenciaChange(e)}),this.updateMontoPreview(this.montoInicial?.value),this.handleFrecuenciaChange(this.frecuencia?.value)}loadIngresoData(){if(this.data.ingreso){let e=this.data.ingreso;this.ingresoForm.patchValue({fuente:e.fuente||"",descripcion:e.descripcion||"",montoInicial:e.montoInicial??0,fechaInicio:e.fechaInicio||this.getCurrentMonth(),frecuencia:e.frecuencia||"MENSUAL",proyeccionAumento:e.proyeccionAumento??0,periodicidadAumento:e.periodicidadAumento??null,duracionMeses:e.duracionMeses??null,notas:e.notas??"",activo:e.activo??!0}),this.handleFrecuenciaChange(e.frecuencia),this.updateMontoPreview(e.montoInicial)}}resetFormData(){this.ingresoForm.reset({fuente:"",descripcion:"",montoInicial:0,fechaInicio:this.getCurrentMonth(),frecuencia:"MENSUAL",proyeccionAumento:0,periodicidadAumento:"ANUAL",duracionMeses:null,notas:"",activo:!0}),this.handleFrecuenciaChange("MENSUAL"),this.montoPreview=""}onMontoChange(e){let o=e.target.value;this.updateMontoPreview(Number(o))}updateMontoPreview(e){let o=typeof e=="string"?Number(e):e;o&&o>0?this.montoPreview=this.formatCurrency(o):this.montoPreview=""}onSubmit(){if(this.ingresoForm.valid){this.loading=!0;let e=this.ingresoForm.value,o;if(e.duracionMeses&&e.duracionMeses>0){let[l,f]=e.fechaInicio.split("-"),g=new Date(parseInt(l),parseInt(f)-1);g.setMonth(g.getMonth()+e.duracionMeses-1),o=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`}let t={fuente:e.fuente.trim(),descripcion:e.descripcion.trim(),montoInicial:Number(e.montoInicial),fechaInicio:e.fechaInicio,frecuencia:e.frecuencia,proyeccionAumento:e.proyeccionAumento||0,periodicidadAumento:e.frecuencia==="UNICA"?void 0:e.periodicidadAumento,duracionMeses:e.duracionMeses,fechaFin:o,notas:e.notas?.trim()||"",activo:e.activo};try{if(this.isEditing&&this.data.ingreso){let l=M(h(h({},this.data.ingreso),t),{fechaActualizacion:new Date().toISOString().split("T")[0]});this.appStateService.updateIncome(l)}else{let l=h({id:Date.now().toString(),fechaCreacion:new Date().toISOString().split("T")[0],fechaActualizacion:new Date().toISOString().split("T")[0]},t);this.appStateService.addIncome(l)}this.loading=!1,this.dialogRef.close(!0)}catch(l){console.error("Error al guardar ingreso:",l),this.loading=!1}}else this.markFormGroupTouched()}onReset(){this.resetFormData()}onCancel(){this.dialogRef.close()}formatCurrency(e){return!e||e<=0?"$0":new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}markFormGroupTouched(){Object.keys(this.ingresoForm.controls).forEach(e=>{this.ingresoForm.get(e)?.markAsTouched()})}getCurrentMonth(){let e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}handleFrecuenciaChange(e){e==="UNICA"&&this.ingresoForm.patchValue({duracionMeses:null,proyeccionAumento:0,periodicidadAumento:null},{emitEvent:!1})}calcularMontoMensual(){let e=this.montoInicial?.value||0;switch(this.frecuencia?.value||"MENSUAL"){case"QUINCENAL":return e*2;case"MENSUAL":return e;case"UNICA":return 0;default:return e}}calcularMontoAnual(){return this.calcularMontoMensual()*12}calcularIngresoTotal(){let e=this.montoInicial?.value||0,o=this.duracionMeses?.value;return(this.frecuencia?.value||"MENSUAL")==="UNICA"?e:o?this.calcularMontoMensual()*o:0}calcularProximoAumento(){let e=this.fechaInicio?.value,o=this.periodicidadAumento?.value||"ANUAL";if(!e||!this.proyeccionAumento?.value)return null;let t=new Date(e+"-01");switch(o){case"MENSUAL":t.setMonth(t.getMonth()+1);break;case"BIMESTRAL":t.setMonth(t.getMonth()+2);break;case"TRIMESTRAL":t.setMonth(t.getMonth()+3);break;case"SEMESTRAL":t.setMonth(t.getMonth()+6);break;case"ANUAL":t.setFullYear(t.getFullYear()+1);break}return t}formatDate(e){return e?(typeof e=="string"?new Date(e+"-01"):e).toLocaleDateString("es-AR",{year:"numeric",month:"long"}):""}formatPercentage(e){return e==null||e===0?"0%":`${e.toFixed(1)}%`}getDuracionTexto(){let e=this.duracionMeses?.value;return this.frecuencia?.value==="UNICA"?"Ingreso \xFAnico":e?e===1?"1 mes":`${e} meses`:"Indefinido"}getFrecuenciaTexto(){let e=this.frecuencia?.value||"MENSUAL";return{QUINCENAL:"Quincenal",MENSUAL:"Mensual",UNICA:"\xDAnica"}[e]||"Mensual"}get isFormValid(){return this.ingresoForm.valid}get canSubmit(){return this.isFormValid&&!this.loading}get fuente(){return this.ingresoForm.get("fuente")}get descripcion(){return this.ingresoForm.get("descripcion")}get montoInicial(){return this.ingresoForm.get("montoInicial")}get fechaInicio(){return this.ingresoForm.get("fechaInicio")}get frecuencia(){return this.ingresoForm.get("frecuencia")}get proyeccionAumento(){return this.ingresoForm.get("proyeccionAumento")}get periodicidadAumento(){return this.ingresoForm.get("periodicidadAumento")}get duracionMeses(){return this.ingresoForm.get("duracionMeses")}get notas(){return this.ingresoForm.get("notas")}get activo(){return this.ingresoForm.get("activo")}static \u0275fac=function(o){return new(o||a)(p(J),p(K),p(E),p(U),p(ee))};static \u0275cmp=S({type:a,selectors:[["app-ingreso-dialog"]],decls:65,vars:12,consts:[[1,"unified-modal"],[1,"modal-header"],[1,"header-content"],[1,"header-icon"],[1,"header-title"],["mat-icon-button","","mat-dialog-close","",1,"close-button"],[1,"modal-content"],[3,"keydown.enter","formGroup"],[1,"form-section"],[1,"form-row"],[1,"half-width"],["matInput","","formControlName","fuente","required",""],[4,"ngIf"],["matInput","","formControlName","descripcion","required",""],["matInput","","type","number","formControlName","montoInicial","required","","min","0.01"],["matTextPrefix",""],["formControlName","frecuencia","required",""],["value","MENSUAL"],["value","QUINCENAL"],["value","UNICA"],["class","form-section",4,"ngIf"],["matInput","","type","month","formControlName","fechaInicio","required","",3,"click"],["class","half-width",4,"ngIf"],[1,"modal-actions"],["mat-stroked-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20",4,"ngIf"],["matInput","","type","number","formControlName","proyeccionAumento","min","0"],["matTextSuffix",""],["formControlName","periodicidadAumento"],["value","ANUAL"],["value","SEMESTRAL"],["value","TRIMESTRAL"],["matInput","","type","number","formControlName","duracionMeses","min","1"],["diameter","20"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),r(4,"trending_up"),i(),n(5,"h2",4),r(6),i()(),n(7,"button",5)(8,"mat-icon"),r(9,"close"),i()()(),n(10,"div",6)(11,"form",7),I("keydown.enter",function(){return t.onSave()}),n(12,"div",8)(13,"h3"),r(14,"Informaci\xF3n B\xE1sica"),i(),n(15,"div",9)(16,"mat-form-field",10)(17,"mat-label"),r(18,"Fuente"),i(),d(19,"input",11),u(20,ie,2,0,"mat-error",12),i(),n(21,"mat-form-field",10)(22,"mat-label"),r(23,"Descripci\xF3n"),i(),d(24,"input",13),u(25,ne,2,0,"mat-error",12),i()()(),n(26,"div",8)(27,"h3"),r(28,"Detalles Financieros"),i(),n(29,"div",9)(30,"mat-form-field",10)(31,"mat-label"),r(32,"Monto Inicial"),i(),d(33,"input",14),n(34,"span",15),r(35,"$\xA0"),i(),u(36,re,2,0,"mat-error",12),i(),n(37,"mat-form-field",10)(38,"mat-label"),r(39,"Frecuencia"),i(),n(40,"mat-select",16)(41,"mat-option",17),r(42,"Mensual"),i(),n(43,"mat-option",18),r(44,"Quincenal"),i(),n(45,"mat-option",19),r(46,"\xDAnica vez"),i()(),u(47,oe,2,0,"mat-error",12),i()()(),u(48,ae,20,0,"div",20),n(49,"div",8)(50,"h3"),r(51,"Temporalidad"),i(),n(52,"div",9)(53,"mat-form-field",10)(54,"mat-label"),r(55,"Fecha de Inicio"),i(),n(56,"input",21),I("click",function(f){return f.target.showPicker()}),i(),u(57,me,2,0,"mat-error",12),i(),u(58,le,6,0,"mat-form-field",22),i()()()(),n(59,"div",23)(60,"button",24),r(61,"Cancelar"),i(),n(62,"button",25),I("click",function(){return t.onSubmit()}),u(63,se,1,0,"mat-spinner",26)(64,ce,2,1,"span",12),i()()()),o&2&&(m(6),v(t.data.title||(t.isEditing?"Editar Ingreso":"Nuevo Ingreso")),m(5),s("formGroup",t.ingresoForm),m(9),s("ngIf",t.fuente==null?null:t.fuente.hasError("required")),m(5),s("ngIf",t.descripcion==null?null:t.descripcion.hasError("required")),m(11),s("ngIf",t.montoInicial==null?null:t.montoInicial.hasError("required")),m(11),s("ngIf",t.frecuencia==null?null:t.frecuencia.hasError("required")),m(),s("ngIf",(t.frecuencia==null?null:t.frecuencia.value)!=="UNICA"),m(9),s("ngIf",t.fechaInicio==null?null:t.fechaInicio.hasError("required")),m(),s("ngIf",(t.frecuencia==null?null:t.frecuencia.value)!=="UNICA"),m(4),s("disabled",t.ingresoForm.invalid||t.loading),m(),s("ngIf",t.loading),m(),s("ngIf",!t.loading))},dependencies:[F,C,k,N,D,y,b,_,L,w,x,T,R,Z,P,q,V,H,Q,G,j,O,$,B,z,Y,W,X],encapsulation:2})};export{te as a};
