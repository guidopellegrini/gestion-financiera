import{Bd as T,Dd as h,E as p,Ea as c,Fa as i,Fd as H,Ga as o,Ha as b,J as _,K as S,Lb as E,M as g,Qa as I,R as O,Ra as R,S as A,Tb as d,d as v,db as r,ea as s,eb as w,ia as m,l as C,ma as y,na as P,qa as x,rd as G,sd as L,td as z,ud as j,vc as k,vd as F,w as M,wd as U,zd as u}from"./chunk-JUX2TMYD.js";var f=class n{constructor(t,e,a){this.authAdapterService=t;this.migrationService=e;this.router=a}canActivate(t,e){return this.checkAuth(e.url)}canActivateChild(t,e){return this.checkAuth(e.url)}checkAuth(t){return this.authAdapterService.loading$.pipe(p(e=>e?this.authAdapterService.loading$.pipe(M(1),p(()=>this.performAuthCheck(t))):this.performAuthCheck(t)))}performAuthCheck(t){return this.authAdapterService.isAuthenticated$.pipe(M(1),p(e=>e?this.handleAuthenticatedUser():(this.redirectToLogin(t),C(!1))))}handleAuthenticatedUser(){return this.migrationService.hasLocalDataToMigrate()&&!this.migrationService.isMigrationCompleted()&&this.migrationService.autoMigrateOnLogin().catch(t=>{console.error("Error en migraci\xF3n autom\xE1tica:",t)}),C(!0)}redirectToLogin(t){sessionStorage.setItem("returnUrl",t),this.router.navigate(["/login"])}getReturnUrl(){let t=sessionStorage.getItem("returnUrl");return sessionStorage.removeItem("returnUrl"),t||"/dashboard"}static \u0275fac=function(e){return new(e||n)(g(h),g(H),g(u))};static \u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})};function V(n,t){if(n&1&&(i(0,"div",15)(1,"mat-icon"),r(2,"error"),o(),i(3,"span"),r(4),o()()),n&2){let e=R();s(4),w(e.error)}}function q(n,t){n&1&&(i(0,"span"),r(1,"Continuar con Google"),o())}function J(n,t){n&1&&(i(0,"span"),r(1,"Iniciando sesi\xF3n..."),o())}function K(n,t){n&1&&b(0,"mat-spinner",16)}var l=class n{constructor(t,e,a){this.authAdapterService=t;this.router=e;this.authGuard=a}loading=!1;error=null;ngOnInit(){this.authAdapterService.isAuthenticated$.subscribe(t=>{if(t){let e=this.authGuard.getReturnUrl();this.router.navigate([e])}}),this.isGithubPagesHost()&&this.handleRedirectResult()}signInWithGoogle(){return v(this,null,function*(){try{if(this.loading=!0,this.error=null,this.isGithubPagesHost()){yield this.authAdapterService.signInWithGoogleRedirect();return}yield this.authAdapterService.signInWithGoogle()}catch(t){console.error("Error en login:",t),this.error=t.message||"Error al iniciar sesi\xF3n"}finally{this.loading=!1}})}isGithubPagesHost(){try{return typeof window<"u"&&window.location.hostname==="guidopellegrini.github.io"}catch{return!1}}handleRedirectResult(){return v(this,null,function*(){try{if(yield this.authAdapterService.getRedirectResult()){let e=this.authGuard.getReturnUrl();this.router.navigate([e])}}catch(t){console.error("Error al procesar redirect:",t),this.error=t.message||"Error al procesar autenticaci\xF3n"}})}static \u0275fac=function(e){return new(e||n)(m(h),m(u),m(f))};static \u0275cmp=y({type:n,selectors:[["app-login"]],decls:24,vars:5,consts:[[1,"login-container"],[1,"login-card"],[1,"login-header"],[1,"login-content"],["class","error-message",4,"ngIf"],["mat-raised-button","","color","primary",1,"google-signin-btn",3,"click","disabled"],[1,"button-content"],["viewBox","0 0 24 24","width","20","height","20",1,"google-icon"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"],[4,"ngIf"],["diameter","20","class","login-spinner",4,"ngIf"],[1,"login-info"],[1,"error-message"],["diameter","20",1,"login-spinner"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),r(4,"Gesti\xF3n Financiera"),o(),i(5,"p"),r(6,"Inicia sesi\xF3n para acceder a tu informaci\xF3n financiera"),o()(),i(7,"div",3),x(8,V,5,1,"div",4),i(9,"button",5),I("click",function(){return a.signInWithGoogle()}),i(10,"div",6),O(),i(11,"svg",7),b(12,"path",8)(13,"path",9)(14,"path",10)(15,"path",11),o(),x(16,q,2,0,"span",12)(17,J,2,0,"span",12)(18,K,1,0,"mat-spinner",13),o()(),A(),i(19,"div",14)(20,"mat-icon"),r(21,"info"),o(),i(22,"p"),r(23," Al iniciar sesi\xF3n, tus datos locales se sincronizar\xE1n autom\xE1ticamente con la nube para acceso desde cualquier dispositivo. "),o()()()()()),e&2&&(s(8),c("ngIf",a.error),s(),c("disabled",a.loading),s(7),c("ngIf",!a.loading),s(),c("ngIf",a.loading),s(),c("ngIf",a.loading))},dependencies:[d,E,L,G,j,z,U,F],styles:[".login-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--mat-sys-primary-container) 0%,var(--mat-sys-secondary-container) 100%);padding:20px}.login-card[_ngcontent-%COMP%]{background:var(--mat-sys-surface);border-radius:16px;box-shadow:var(--mat-sys-elevation-level3);padding:40px;max-width:400px;width:100%;text-align:center}.login-header[_ngcontent-%COMP%]{margin-bottom:32px}.login-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface);font-size:28px;font-weight:600;margin:0 0 8px}.login-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);font-size:16px;margin:0;line-height:1.5}.login-content[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:var(--mat-sys-error-container);color:var(--mat-sys-on-error-container);padding:12px 16px;border-radius:8px;margin-bottom:24px;font-size:14px}.login-content[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.login-content[_ngcontent-%COMP%]   .google-signin-btn[_ngcontent-%COMP%]{width:100%;height:48px;font-size:16px;font-weight:500;margin-bottom:24px}.login-content[_ngcontent-%COMP%]   .google-signin-btn[_ngcontent-%COMP%]   .button-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px}.login-content[_ngcontent-%COMP%]   .google-signin-btn[_ngcontent-%COMP%]   .button-content[_ngcontent-%COMP%]   .google-icon[_ngcontent-%COMP%]{flex-shrink:0}.login-content[_ngcontent-%COMP%]   .google-signin-btn[_ngcontent-%COMP%]   .button-content[_ngcontent-%COMP%]   .login-spinner[_ngcontent-%COMP%]{margin-left:8px}.login-content[_ngcontent-%COMP%]   .login-info[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;background:var(--mat-sys-primary-container);color:var(--mat-sys-on-primary-container);padding:16px;border-radius:8px;text-align:left}.login-content[_ngcontent-%COMP%]   .login-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:20px;width:20px;height:20px;margin-top:2px;flex-shrink:0}.login-content[_ngcontent-%COMP%]   .login-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.5}@media (max-width: 480px){.login-container[_ngcontent-%COMP%]{padding:16px}.login-card[_ngcontent-%COMP%]{padding:24px}.login-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}}"]})};var N=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=P({type:n});static \u0275inj=S({imports:[d,k,l,T.forChild([{path:"",component:l}])]})};export{f as a,N as b};
